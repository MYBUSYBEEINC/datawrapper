!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("svelte/publish/guest",e):(t="undefined"!=typeof globalThis?globalThis:t||self)["publish/guest"]=e()}(this,(function(){"use strict";function t(){}function e(t,e){for(var n in e)t[n]=e[n];return t}function n(t,e){t.appendChild(e)}function r(t,e,n){t.insertBefore(e,n)}function s(t){t.parentNode.removeChild(t)}function o(t,e){for(;t.nextSibling&&t.nextSibling!==e;)t.parentNode.removeChild(t.nextSibling)}function i(t,e){for(var n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function a(t){return document.createElement(t)}function c(t){return document.createTextNode(t)}function u(){return document.createComment("")}function l(t,e,n,r){t.addEventListener(e,n,r)}function d(t,e,n,r){t.removeEventListener(e,n,r)}function h(t,e,n){t.style.setProperty(e,n)}function p(t,e,n){t.classList[n?"add":"remove"](e)}function f(){return Object.create(null)}function m(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function _(t,e){return t!=t?e==e:t!==e}function g(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var r=0;r<n.length;r+=1){var s=n[r];if(!s.__calling)try{s.__calling=!0,s.call(this,e)}finally{s.__calling=!1}}}function v(t){t._lock=!0,y(t._beforecreate),y(t._oncreate),y(t._aftercreate),t._lock=!1}function b(){return this._state}function w(t,e){t._handlers=f(),t._slots=f(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function x(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}}function y(t){for(;t&&t.length;)t.shift()()}var T={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:b,fire:g,on:x,set:function(t){this._set(e({},t)),this.root._lock||v(this.root)},_recompute:t,_set:function(t){var n=this._state,r={},s=!1;for(var o in t=e(this._staged,t),this._staged={},t)this._differs(t[o],n[o])&&(r[o]=s=!0);s&&(this._state=e(e({},n),t),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:n}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:n})))},_stage:function(t){e(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:m};const C={};function N(t="core"){"chart"===t?window.__dw&&window.__dw.vis&&window.__dw.vis.meta&&(C[t]=window.__dw.vis.meta.locale||{}):C[t]="core"===t?dw.backend.__messages.core:Object.assign({},dw.backend.__messages.core,dw.backend.__messages[t])}function k(t,e="core"){if(t=t.trim(),C[e]||N(e),!C[e][t])return"MISSING:"+t;var n=C[e][t];return"string"==typeof n&&arguments.length>2&&(n=n.replace(/\$(\d)/g,(t,e)=>(e=2+Number(e),void 0===arguments[e]?t:arguments[e]))),n}var E={exports:{}};
/*!
	 * JavaScript Cookie v2.2.1
	 * https://github.com/js-cookie/js-cookie
	 *
	 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
	 * Released under the MIT license
	 */!function(t,e){var n;n=function(){function t(){for(var t=0,e={};t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function s(){}function o(e,n,o){if("undefined"!=typeof document){"number"==typeof(o=t({path:"/"},s.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var i=JSON.stringify(n);/^[\{\[]/.test(i)&&(n=i)}catch(t){}n=r.write?r.write(n,e):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in o)o[c]&&(a+="; "+c,!0!==o[c]&&(a+="="+o[c].split(";")[0]));return document.cookie=e+"="+n+a}}function i(t,n){if("undefined"!=typeof document){for(var s={},o=document.cookie?document.cookie.split("; "):[],i=0;i<o.length;i++){var a=o[i].split("="),c=a.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=e(a[0]);if(c=(r.read||r)(c,u)||e(c),n)try{c=JSON.parse(c)}catch(t){}if(s[u]=c,t===u)break}catch(t){}}return t?s[t]:s}}return s.set=o,s.get=function(t){return i(t,!1)},s.getJSON=function(t){return i(t,!0)},s.remove=function(e,n){o(e,"",t(n,{expires:-1}))},s.defaults={},s.withConverter=n,s}((function(){}))},t.exports=n()}(E);var L=E.exports;const H=new Set(["get","head","options","trace"]);function U(t,e={}){if(!e.fetch)try{e.fetch=window.fetch}catch(t){throw new Error("Neither options.fetch nor window.fetch is defined.")}if(!e.baseUrl)try{e.baseUrl="//"+window.dw.backend.__api_domain}catch(t){throw new Error("Neither options.baseUrl nor window.dw is defined.")}const{payload:n,baseUrl:r,fetch:s,raw:o,...i}={payload:null,raw:!1,method:"GET",mode:"cors",credentials:"include",...e,headers:{"Content-Type":"application/json",...e.headers}},a=`${r.replace(/\/$/,"")}/${t.replace(/^\//,"")}`;let c;if(n&&(i.body=JSON.stringify(n)),H.has(i.method.toLowerCase()))c=s(a,i);else{const t=L.get("crumb");t?(i.headers["X-CSRF-Token"]=t,c=s(a,i)):c=U("/v3/me",{fetch:s,baseUrl:r}).then(()=>{const t=L.get("crumb");t&&(i.headers["X-CSRF-Token"]=t)}).catch(()=>{}).then(()=>s(a,i))}return c.then(t=>{if(o)return t;if(!t.ok)throw new M(t);if(204===t.status||!t.headers.get("content-type"))return t;const e=t.headers.get("content-type").split(";")[0];return"application/json"===e?t.json():"image/png"===e||"application/pdf"===e?t.blob():t.text()})}U.get=j("GET"),U.patch=j("PATCH"),U.put=j("PUT");const S=U.post=j("POST");function j(t){return(e,n)=>{if(n&&n.method)throw new Error(`Setting option.method is not allowed in httpReq.${t.toLowerCase()}()`);return U(e,{...n,method:t})}}U.head=j("HEAD"),U.delete=j("DELETE");class M extends Error{constructor(t){super(),this.name="HttpReqError",this.status=t.status,this.statusText=t.statusText,this.message=`[${t.status}] ${t.statusText}`,this.response=t}}function A(t,e){var n;return{c(){(n=a("label")).className="control-label svelte-1nkiaxn"},m(t,s){r(t,n,s),n.innerHTML=e.label},p(t,e){t.label&&(n.innerHTML=e.label)},d(t){t&&s(n)}}}function $(t,e){var n;return{c(){(n=a("div")).className="help success svelte-1nkiaxn"},m(t,s){r(t,n,s),n.innerHTML=e.success},p(t,e){t.success&&(n.innerHTML=e.success)},d(t){t&&s(n)}}}function O(t,e){var n;return{c(){(n=a("div")).className="help error svelte-1nkiaxn"},m(t,s){r(t,n,s),n.innerHTML=e.error},p(t,e){t.error&&(n.innerHTML=e.error)},d(t){t&&s(n)}}}function P(t,e){var n;return{c(){(n=a("div")).className="help svelte-1nkiaxn"},m(t,s){r(t,n,s),n.innerHTML=e.help},p(t,e){t.help&&(n.innerHTML=e.help)},d(t){t&&s(n)}}}function R(t){var o,i,u,l,d,f,m,_,g,v,b,x,y;w(this,t),this._state=e({label:"",help:"",error:!1,success:!1,width:"auto",uid:""},t.data),this._intro=!0,this._slotted=t.slots||{},this._fragment=(o=this,i=this._state,g=o._slotted.default,v=i.label&&A(0,i),b=i.success&&$(0,i),x=i.error&&O(0,i),y=!i.success&&!i.error&&i.help&&P(0,i),{c(){u=a("div"),v&&v.c(),l=c("\n    "),d=a("div"),f=c("\n    "),b&&b.c(),m=c(" "),x&&x.c(),_=c(" "),y&&y.c(),d.className="form-controls svelte-1nkiaxn",u.className="form-block svelte-1nkiaxn",h(u,"width",i.width),u.dataset.uid=i.uid,p(u,"success",i.success),p(u,"error",i.error)},m(t,e){r(t,u,e),v&&v.m(u,null),n(u,l),n(u,d),g&&n(d,g),n(u,f),b&&b.m(u,null),n(u,m),x&&x.m(u,null),n(u,_),y&&y.m(u,null)},p(t,e){e.label?v?v.p(t,e):((v=A(0,e)).c(),v.m(u,l)):v&&(v.d(1),v=null),e.success?b?b.p(t,e):((b=$(0,e)).c(),b.m(u,m)):b&&(b.d(1),b=null),e.error?x?x.p(t,e):((x=O(0,e)).c(),x.m(u,_)):x&&(x.d(1),x=null),e.success||e.error||!e.help?y&&(y.d(1),y=null):y?y.p(t,e):((y=P(0,e)).c(),y.m(u,null)),t.width&&h(u,"width",e.width),t.uid&&(u.dataset.uid=e.uid),t.success&&p(u,"success",e.success),t.error&&p(u,"error",e.error)},d(t){t&&s(u),v&&v.d(),g&&function(t,e){for(;t.firstChild;)e.appendChild(t.firstChild)}(d,g),b&&b.d(),x&&x.d(),y&&y.d()}}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}e(R.prototype,T);var D={async createAccount(t){var e,n,r,s;this.set({signedUp:!0}),e="Chart Editor",n="send-embed-code",window._paq&&window._paq.push(["trackEvent",e,n,r,s]);try{let e=null;e=void 0!==window.chart?window.chart.get().id:this.store.get().id;const n=await S("/v3/auth/signup",{payload:{email:t,invitation:!0,chartId:e}});this.get().fromSvelte?(this.set({signedUp:!1,error:""}),this.store.set({user:n})):window.location.reload()}catch(t){if("HttpReqError"===t.name){const e=await t.response.json();this.set({error:e.message||t})}else this.set({error:"Unknown error: "+t})}}};function I(t,e,n){const r=Object.create(t);return r.text=e[n],r}function q(t,e,n){const r=Object.create(t);return r.text=e[n],r}function B(e,n){var o,i,u,l=k("publish / guest / h1"),d=k("publish / guest / p");return{c(){o=a("h2"),i=c("\n\n            "),u=a("p")},m(t,e){r(t,o,e),o.innerHTML=l,r(t,i,e),r(t,u,e),u.innerHTML=d},p:t,d(t){t&&(s(o),s(i),s(u))}}}function F(t,e){for(var n,o=e.guest_text_above,a=[],c=0;c<o.length;c+=1)a[c]=J(t,q(e,o,c));return{c(){for(var t=0;t<a.length;t+=1)a[t].c();n=u()},m(t,e){for(var s=0;s<a.length;s+=1)a[s].m(t,e);r(t,n,e)},p(e,r){if(e.guest_text_above){o=r.guest_text_above;for(var s=0;s<o.length;s+=1){const i=q(r,o,s);a[s]?a[s].p(e,i):(a[s]=J(t,i),a[s].c(),a[s].m(n.parentNode,n))}for(;s<a.length;s+=1)a[s].d(1);a.length=o.length}},d(t){i(a,t),t&&s(n)}}}function J(t,e){var n,i,c=e.text;return{c(){n=a("noscript"),i=a("noscript")},m(t,e){r(t,n,e),n.insertAdjacentHTML("afterend",c),r(t,i,e)},p(t,e){t.guest_text_above&&c!==(c=e.text)&&(o(n,i),n.insertAdjacentHTML("afterend",c))},d(t){t&&(o(n,i),s(n),s(i))}}}function G(t,e){for(var n,o=e.guest_text_below,a=[],c=0;c<o.length;c+=1)a[c]=X(t,I(e,o,c));return{c(){for(var t=0;t<a.length;t+=1)a[t].c();n=u()},m(t,e){for(var s=0;s<a.length;s+=1)a[s].m(t,e);r(t,n,e)},p(e,r){if(e.guest_text_below){o=r.guest_text_below;for(var s=0;s<o.length;s+=1){const i=I(r,o,s);a[s]?a[s].p(e,i):(a[s]=X(t,i),a[s].c(),a[s].m(n.parentNode,n))}for(;s<a.length;s+=1)a[s].d(1);a.length=o.length}},d(t){i(a,t),t&&s(n)}}}function X(t,e){var n,i,c=e.text;return{c(){n=a("noscript"),i=a("noscript")},m(t,e){r(t,n,e),n.insertAdjacentHTML("afterend",c),r(t,i,e)},p(t,e){t.guest_text_below&&c!==(c=e.text)&&(o(n,i),n.insertAdjacentHTML("afterend",c))},d(t){t&&(o(n,i),s(n),s(i))}}}function Z(t,e){var o,i;return{c(){o=a("div"),i=c(e.error),o.className="alert alert-warning"},m(t,e){r(t,o,e),n(o,i)},p(t,e){t.error&&function(t,e){t.data=""+e}(i,e.error)},d(t){t&&s(o)}}}function z(t){w(this,t),this._state=e({error:"",email:"",guest_text_above:[],guest_text_below:[],signedUp:!1},t.data),this._intro=!0,this._fragment=function(t,e){var o,i,u,p,f,m,_,g,v,b,w,x,y,T,C,N,E,L,H,U,S=!1,j=k("publish / guest / cta"),M=k("publish / guest / back");function A(t){return t.guest_text_above?F:B}var $=A(e),O=$(t,e);function P(){S=!0,t.set({email:m.value}),S=!1}function D(n){t.createAccount(e.email)}var I={label:k("publish / guest / e-mail"),help:k("publish / guest / example-email")},q=new R({root:t.root,store:t.store,slots:{default:document.createDocumentFragment()},data:I}),J=e.guest_text_below&&G(t,e),X=e.error&&Z(t,e);return{c(){var t,n,r;o=a("div"),i=a("div"),u=a("div"),O.c(),p=c("\n\n        "),f=a("div"),m=a("input"),_=c("\n\n                "),g=a("button"),v=a("i"),w=c("\n                      "),x=a("noscript"),q._fragment.c(),y=c("\n\n        "),J&&J.c(),T=c("\n\n        "),C=a("div"),N=a("button"),E=a("i"),L=c("   "),H=a("noscript"),U=c("\n\n            "),X&&X.c(),h(u,"margin-bottom","20px"),l(m,"input",P),t=m,n="type",null==(r="email")?t.removeAttribute(n):t.setAttribute(n,r),m.className="input-xlarge",v.className=b="fa "+(e.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"),l(g,"click",D),g.className="btn btn-save btn-primary",h(g,"white-space","nowrap"),h(g,"margin-left","10px"),h(f,"display","flex"),E.className="fa fa-chevron-left",N.className="btn btn-save btn-default btn-back",h(C,"margin-top","30px"),i.className="span5",o.className="row publish-signup"},m(t,s){r(t,o,s),n(o,i),n(i,u),O.m(u,null),n(i,p),n(q._slotted.default,f),n(f,m),m.value=e.email,n(f,_),n(f,g),n(g,v),n(g,w),n(g,x),x.insertAdjacentHTML("afterend",j),q._mount(i,null),n(i,y),J&&J.m(i,null),n(i,T),n(i,C),n(C,N),n(N,E),n(N,L),n(N,H),H.insertAdjacentHTML("afterend",M),n(C,U),X&&X.m(C,null)},p(n,r){$===($=A(e=r))&&O?O.p(n,e):(O.d(1),(O=$(t,e)).c(),O.m(u,null)),!S&&n.email&&(m.value=e.email),n.signedUp&&b!==(b="fa "+(e.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"))&&(v.className=b),e.guest_text_below?J?J.p(n,e):((J=G(t,e)).c(),J.m(i,T)):J&&(J.d(1),J=null),e.error?X?X.p(n,e):((X=Z(t,e)).c(),X.m(C,null)):X&&(X.d(1),X=null)},d(t){t&&s(o),O.d(),d(m,"input",P),d(g,"click",D),q.destroy(),J&&J.d(),X&&X.d()}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),v(this))}function K(t,n){this._handlers={},this._dependents=[],this._computed=f(),this._sortedComputedProperties=[],this._state=e({},t),this._differs=n&&n.immutable?_:m}e(z.prototype,T),e(z.prototype,D),e(K.prototype,{_add(t,e){this._dependents.push({component:t,props:e})},_init(t){const e={};for(let n=0;n<t.length;n+=1){const r=t[n];e["$"+r]=this._state[r]}return e},_remove(t){let e=this._dependents.length;for(;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_set(t,n){const r=this._state;this._state=e(e({},r),t);for(let t=0;t<this._sortedComputedProperties.length;t+=1)this._sortedComputedProperties[t].update(this._state,n);this.fire("state",{changed:n,previous:r,current:this._state}),this._dependents.filter(t=>{const e={};let r=!1;for(let s=0;s<t.props.length;s+=1){const o=t.props[s];o in n&&(e["$"+o]=this._state[o],r=!0)}if(r)return t.component._stage(e),!0}).forEach(t=>{t.component.set({})}),this.fire("update",{changed:n,previous:r,current:this._state})},_sortComputedProperties(){const t=this._computed,e=this._sortedComputedProperties=[],n=f();let r;function s(o){const i=t[o];i&&(i.deps.forEach(t=>{if(t===r)throw new Error(`Cyclical dependency detected between ${t} <-> ${o}`);s(t)}),n[o]||(n[o]=!0,e.push(i)))}for(const t in this._computed)s(r=t)},compute(t,n,r){let s;const o={deps:n,update:(e,o,i)=>{const a=n.map(t=>(t in o&&(i=!0),e[t]));if(i){const n=r.apply(null,a);this._differs(n,s)&&(s=n,o[t]=!0,e[t]=s)}}};this._computed[t]=o,this._sortComputedProperties();const i=e({},this._state),a={};o.update(i,a,!0),this._set(i,a)},fire:g,get:b,on:x,set(t){const e=this._state,n=this._changed={};let r=!1;for(const s in t){if(this._computed[s])throw new Error(`'${s}' is a read-only computed property`);this._differs(t[s],e[s])&&(n[s]=r=!0)}r&&this._set(t,n)}});return{App:z,store:new K({})}}));
