!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("svelte/publish/guest",t):(e="undefined"!=typeof globalThis?globalThis:e||self)["publish/guest"]=t()}(this,(function(){"use strict";function e(){}function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e,t){e.appendChild(t)}function r(e,t,n){e.insertBefore(t,n)}function s(e){e.parentNode.removeChild(e)}function i(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}function o(e){return document.createElement(e)}function a(e){return document.createTextNode(e)}function c(e,t,n,r){e.addEventListener(t,n,r)}function d(e,t,n,r){e.removeEventListener(t,n,r)}function u(e,t,n){e.style.setProperty(t,n)}function l(e,t,n){e.classList[n?"add":"remove"](t)}function p(){return Object.create(null)}function h(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function f(e,t){return e!=e?t==t:e!==t}function m(e,t){var n=e in this._handlers&&this._handlers[e].slice();if(n)for(var r=0;r<n.length;r+=1){var s=n[r];if(!s.__calling)try{s.__calling=!0,s.call(this,t)}finally{s.__calling=!1}}}function _(e){e._lock=!0,b(e._beforecreate),b(e._oncreate),b(e._aftercreate),e._lock=!1}function g(){return this._state}function v(e,t){e._handlers=p(),e._slots=p(),e._bind=t._bind,e._staged={},e.options=t,e.root=t.root||e,e.store=t.store||e.root.store,t.root||(e._beforecreate=[],e._oncreate=[],e._aftercreate=[])}function w(e,t){var n=this._handlers[e]||(this._handlers[e]=[]);return n.push(t),{cancel:function(){var e=n.indexOf(t);~e&&n.splice(e,1)}}}function b(e){for(;e&&e.length;)e.shift()()}var y={destroy:function(t){this.destroy=e,this.fire("destroy"),this.set=e,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:g,fire:m,on:w,set:function(e){this._set(t({},e)),this.root._lock||_(this.root)},_recompute:e,_set:function(e){var n=this._state,r={},s=!1;for(var i in e=t(this._staged,e),this._staged={},e)this._differs(e[i],n[i])&&(r[i]=s=!0);s&&(this._state=t(t({},n),e),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:n}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:n})))},_stage:function(e){t(this._staged,e)},_mount:function(e,t){this._fragment[this._fragment.i?"i":"m"](e,t||null)},_differs:h};const x={};function T(e="core"){"chart"===e?window.__dw&&window.__dw.vis&&window.__dw.vis.meta&&(x[e]=window.__dw.vis.meta.locale||{}):x[e]="core"===e?dw.backend.__messages.core:Object.assign({},dw.backend.__messages.core,dw.backend.__messages[e])}function C(e,t="core"){if(e=e.trim(),x[t]||T(t),!x[t][e])return"MISSING:"+e;var n=x[t][e];return"string"==typeof n&&arguments.length>2&&(n=n.replace(/\$(\d)/g,(e,t)=>(t=2+Number(t),void 0===arguments[t]?e:arguments[t]))),n}var k={exports:{}};
/*!
	 * JavaScript Cookie v2.2.1
	 * https://github.com/js-cookie/js-cookie
	 *
	 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
	 * Released under the MIT license
	 */!function(e,t){var n;n=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function s(){}function i(t,n,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},s.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var o=JSON.stringify(n);/^[\{\[]/.test(o)&&(n=o)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in i)i[c]&&(a+="; "+c,!0!==i[c]&&(a+="="+i[c].split(";")[0]));return document.cookie=t+"="+n+a}}function o(e,n){if("undefined"!=typeof document){for(var s={},i=document.cookie?document.cookie.split("; "):[],o=0;o<i.length;o++){var a=i[o].split("="),c=a.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var d=t(a[0]);if(c=(r.read||r)(c,d)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(s[d]=c,e===d)break}catch(e){}}return e?s[e]:s}}return s.set=i,s.get=function(e){return o(e,!1)},s.getJSON=function(e){return o(e,!0)},s.remove=function(t,n){i(t,"",e(n,{expires:-1}))},s.defaults={},s.withConverter=n,s}((function(){}))},e.exports=n()}(k);var N=k.exports;const E=new Set(["get","head","options","trace"]);function L(e,t={}){if(!t.fetch)try{t.fetch=window.fetch}catch(e){throw new Error("Neither options.fetch nor window.fetch is defined.")}if(!t.baseUrl)try{t.baseUrl="//"+window.dw.backend.__api_domain}catch(e){throw new Error("Neither options.baseUrl nor window.dw is defined.")}const{payload:n,baseUrl:r,fetch:s,raw:i,...o}={payload:null,raw:!1,method:"GET",mode:"cors",credentials:"include",...t,headers:{"Content-Type":"application/json",...t.headers}},a=`${r.replace(/\/$/,"")}/${e.replace(/^\//,"")}`;let c;if(n&&(o.body=JSON.stringify(n)),o.headers["Content-Type"].startsWith("multipart/")&&delete o.headers["Content-Type"],E.has(o.method.toLowerCase()))c=s(a,o);else{const e=N.get("crumb");e?(o.headers["X-CSRF-Token"]=e,c=s(a,o)):c=L("/v3/me",{fetch:s,baseUrl:r}).then(()=>{const e=N.get("crumb");e&&(o.headers["X-CSRF-Token"]=e)}).catch(()=>{}).then(()=>s(a,o))}return c.then(e=>{if(i)return e;if(!e.ok)throw new U(e);if(204===e.status||!e.headers.get("content-type"))return e;const t=e.headers.get("content-type").split(";")[0];return"application/json"===t?e.json():"image/png"===t||"application/pdf"===t?e.blob():e.text()})}L.get=H("GET"),L.patch=H("PATCH"),L.put=H("PUT");const A=L.post=H("POST");function H(e){return(t,n)=>{if(n&&n.method)throw new Error(`Setting option.method is not allowed in httpReq.${e.toLowerCase()}()`);return L(t,{...n,method:e})}}L.head=H("HEAD"),L.delete=H("DELETE");class U extends Error{constructor(e){super(),this.name="HttpReqError",this.status=e.status,this.statusText=e.statusText,this.message=`[${e.status}] ${e.statusText}`,this.response=e}}function I(e,t){var n;return{c(){(n=o("label")).className="control-label svelte-1nkiaxn"},m(e,s){r(e,n,s),n.innerHTML=t.label},p(e,t){e.label&&(n.innerHTML=t.label)},d(e){e&&s(n)}}}function M(e,t){var n;return{c(){(n=o("div")).className="help success svelte-1nkiaxn"},m(e,s){r(e,n,s),n.innerHTML=t.success},p(e,t){e.success&&(n.innerHTML=t.success)},d(e){e&&s(n)}}}function S(e,t){var n;return{c(){(n=o("div")).className="help error svelte-1nkiaxn"},m(e,s){r(e,n,s),n.innerHTML=t.error},p(e,t){e.error&&(n.innerHTML=t.error)},d(e){e&&s(n)}}}function j(e,t){var n;return{c(){(n=o("div")).className="help svelte-1nkiaxn"},m(e,s){r(e,n,s),n.innerHTML=t.help},p(e,t){e.help&&(n.innerHTML=t.help)},d(e){e&&s(n)}}}function $(e){var i,c,d,p,h,f,m,_,g,w,b,y,x;v(this,e),this._state=t({label:"",help:"",error:!1,success:!1,width:"auto",uid:""},e.data),this._intro=!0,this._slotted=e.slots||{},this._fragment=(i=this,c=this._state,g=i._slotted.default,w=c.label&&I(0,c),b=c.success&&M(0,c),y=c.error&&S(0,c),x=!c.success&&!c.error&&c.help&&j(0,c),{c(){d=o("div"),w&&w.c(),p=a("\n    "),h=o("div"),f=a("\n    "),b&&b.c(),m=a(" "),y&&y.c(),_=a(" "),x&&x.c(),h.className="form-controls svelte-1nkiaxn",d.className="form-block svelte-1nkiaxn",u(d,"width",c.width),d.dataset.uid=c.uid,l(d,"success",c.success),l(d,"error",c.error)},m(e,t){r(e,d,t),w&&w.m(d,null),n(d,p),n(d,h),g&&n(h,g),n(d,f),b&&b.m(d,null),n(d,m),y&&y.m(d,null),n(d,_),x&&x.m(d,null)},p(e,t){t.label?w?w.p(e,t):((w=I(0,t)).c(),w.m(d,p)):w&&(w.d(1),w=null),t.success?b?b.p(e,t):((b=M(0,t)).c(),b.m(d,m)):b&&(b.d(1),b=null),t.error?y?y.p(e,t):((y=S(0,t)).c(),y.m(d,_)):y&&(y.d(1),y=null),t.success||t.error||!t.help?x&&(x.d(1),x=null):x?x.p(e,t):((x=j(0,t)).c(),x.m(d,null)),e.width&&u(d,"width",t.width),e.uid&&(d.dataset.uid=t.uid),e.success&&l(d,"success",t.success),e.error&&l(d,"error",t.error)},d(e){e&&s(d),w&&w.d(),g&&function(e,t){for(;e.firstChild;)t.appendChild(e.firstChild)}(h,g),b&&b.d(),y&&y.d(),x&&x.d()}}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor))}t($.prototype,y);var P={async createAccount(e){var t,n,r,s;this.set({signedUp:!0}),t="Chart Editor",n="send-embed-code",window._paq&&window._paq.push(["trackEvent",t,n,r,s]);try{await A("/v3/auth/signup",{payload:{email:e,invitation:!0,chartId:this.store.get().id}}),window.location.reload()}catch(e){if("HttpReqError"===e.name){const t=await e.response.json();this.set({error:t.message||e})}else this.set({error:"Unknown error: "+e})}}};function R(t,n){var i,c,d,u=C("publish / guest / h1"),l=C("publish / guest / p");return{c(){i=o("h2"),c=a("\n\n            "),d=o("p")},m(e,t){r(e,i,t),i.innerHTML=u,r(e,c,t),r(e,d,t),d.innerHTML=l},p:e,d(e){e&&(s(i),s(c),s(d))}}}function B(e,t){var n,a;return{c(){n=o("noscript"),a=o("noscript")},m(e,s){r(e,n,s),n.insertAdjacentHTML("afterend",t.guestAboveInvite),r(e,a,s)},p(e,t){e.guestAboveInvite&&(i(n,a),n.insertAdjacentHTML("afterend",t.guestAboveInvite))},d(e){e&&(i(n,a),s(n),s(a))}}}function D(e,t){var i,c;return{c(){i=o("div"),c=a(t.error),i.className="mt-2 alert alert-warning"},m(e,t){r(e,i,t),n(i,c)},p(e,t){e.error&&function(e,t){e.data=""+t}(c,t.error)},d(e){e&&s(i)}}}function O(e){v(this,e),this._state=t({error:"",email:"",guestAboveInvite:"",guestBelowInvite:"",signedUp:!1},e.data),this._intro=!0,this._fragment=function(e,t){var l,p,h,f,m,_,g,v,w,b,y,x,T,k,N,E,L,A,H,U,I,M,S=!1,j=C("publish / guest / cta"),P=C("publish / guest / back");function O(e){return e.guestAboveInvite?B:R}var q=O(t),F=q(e,t);function J(){S=!0,e.set({email:_.value}),S=!1}function G(n){e.createAccount(t.email)}var X={label:C("publish / guest / e-mail"),help:C("publish / guest / example-email")},W=new $({root:e.root,store:e.store,slots:{default:document.createDocumentFragment()},data:X}),Z=t.error&&D(e,t);return{c(){var e,n,r;l=o("div"),p=o("div"),h=o("div"),F.c(),f=a("\n\n        "),m=o("div"),_=o("input"),g=a("\n\n                "),v=o("button"),w=o("i"),y=a("\n                      "),x=o("noscript"),W._fragment.c(),T=a("\n\n        "),k=o("noscript"),N=o("noscript"),E=a("\n\n        "),L=o("div"),A=o("button"),H=o("i"),U=a("   "),I=o("noscript"),M=a("\n\n            "),Z&&Z.c(),u(h,"margin-bottom","20px"),c(_,"input",J),e=_,n="type",null==(r="email")?e.removeAttribute(n):e.setAttribute(n,r),_.className="input-xlarge",w.className=b="fa "+(t.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"),c(v,"click",G),v.className="btn btn-save btn-primary",u(v,"white-space","nowrap"),u(v,"margin-left","10px"),u(m,"display","flex"),H.className="fa fa-chevron-left",A.className="btn btn-save btn-default btn-back",u(L,"margin-top","30px"),p.className="span5",l.className="row publish-signup"},m(e,s){r(e,l,s),n(l,p),n(p,h),F.m(h,null),n(p,f),n(W._slotted.default,m),n(m,_),_.value=t.email,n(m,g),n(m,v),n(v,w),n(v,y),n(v,x),x.insertAdjacentHTML("afterend",j),W._mount(p,null),n(p,T),n(p,k),k.insertAdjacentHTML("afterend",t.guestBelowInvite),n(p,N),n(p,E),n(p,L),n(L,A),n(A,H),n(A,U),n(A,I),I.insertAdjacentHTML("afterend",P),n(L,M),Z&&Z.m(L,null)},p(n,r){q===(q=O(t=r))&&F?F.p(n,t):(F.d(1),(F=q(e,t)).c(),F.m(h,null)),!S&&n.email&&(_.value=t.email),n.signedUp&&b!==(b="fa "+(t.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"))&&(w.className=b),n.guestBelowInvite&&(i(k,N),k.insertAdjacentHTML("afterend",t.guestBelowInvite)),t.error?Z?Z.p(n,t):((Z=D(e,t)).c(),Z.m(L,null)):Z&&(Z.d(1),Z=null)},d(e){e&&s(l),F.d(),d(_,"input",J),d(v,"click",G),W.destroy(),Z&&Z.d()}}}(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),_(this))}function q(e,n){this._handlers={},this._dependents=[],this._computed=p(),this._sortedComputedProperties=[],this._state=t({},e),this._differs=n&&n.immutable?f:h}t(O.prototype,y),t(O.prototype,P),t(q.prototype,{_add(e,t){this._dependents.push({component:e,props:t})},_init(e){const t={};for(let n=0;n<e.length;n+=1){const r=e[n];t["$"+r]=this._state[r]}return t},_remove(e){let t=this._dependents.length;for(;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_set(e,n){const r=this._state;this._state=t(t({},r),e);for(let e=0;e<this._sortedComputedProperties.length;e+=1)this._sortedComputedProperties[e].update(this._state,n);this.fire("state",{changed:n,previous:r,current:this._state}),this._dependents.filter(e=>{const t={};let r=!1;for(let s=0;s<e.props.length;s+=1){const i=e.props[s];i in n&&(t["$"+i]=this._state[i],r=!0)}if(r)return e.component._stage(t),!0}).forEach(e=>{e.component.set({})}),this.fire("update",{changed:n,previous:r,current:this._state})},_sortComputedProperties(){const e=this._computed,t=this._sortedComputedProperties=[],n=p();let r;function s(i){const o=e[i];o&&(o.deps.forEach(e=>{if(e===r)throw new Error(`Cyclical dependency detected between ${e} <-> ${i}`);s(e)}),n[i]||(n[i]=!0,t.push(o)))}for(const e in this._computed)s(r=e)},compute(e,n,r){let s;const i={deps:n,update:(t,i,o)=>{const a=n.map(e=>(e in i&&(o=!0),t[e]));if(o){const n=r.apply(null,a);this._differs(n,s)&&(s=n,i[e]=!0,t[e]=s)}}};this._computed[e]=i,this._sortComputedProperties();const o=t({},this._state),a={};i.update(o,a,!0),this._set(o,a)},fire:m,get:g,on:w,set(e){const t=this._state,n=this._changed={};let r=!1;for(const s in e){if(this._computed[s])throw new Error(`'${s}' is a read-only computed property`);this._differs(e[s],t[s])&&(n[s]=r=!0)}r&&this._set(e,n)}});return{App:O,store:new q({})}}));
