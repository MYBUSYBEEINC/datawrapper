!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("svelte/publish/guest",t):(e="undefined"!=typeof globalThis?globalThis:e||self)["publish/guest"]=t()}(this,(function(){"use strict";function e(){}function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e,t){e.appendChild(t)}function s(e,t,n){e.insertBefore(t,n)}function r(e){e.parentNode.removeChild(e)}function i(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}function o(e){return document.createElement(e)}function a(e){return document.createTextNode(e)}function c(e,t,n,s){e.addEventListener(t,n,s)}function d(e,t,n,s){e.removeEventListener(t,n,s)}function l(e,t,n){e.style.setProperty(t,n)}function u(e,t,n){e.classList[n?"add":"remove"](t)}function p(){return Object.create(null)}function h(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function f(e,t){return e!=e?t==t:e!==t}function m(e,t){var n=e in this._handlers&&this._handlers[e].slice();if(n)for(var s=0;s<n.length;s+=1){var r=n[s];if(!r.__calling)try{r.__calling=!0,r.call(this,t)}finally{r.__calling=!1}}}function _(e){e._lock=!0,w(e._beforecreate),w(e._oncreate),w(e._aftercreate),e._lock=!1}function g(){return this._state}function v(e,t){e._handlers=p(),e._slots=p(),e._bind=t._bind,e._staged={},e.options=t,e.root=t.root||e,e.store=t.store||e.root.store,t.root||(e._beforecreate=[],e._oncreate=[],e._aftercreate=[])}function b(e,t){var n=this._handlers[e]||(this._handlers[e]=[]);return n.push(t),{cancel:function(){var e=n.indexOf(t);~e&&n.splice(e,1)}}}function w(e){for(;e&&e.length;)e.shift()()}var y={destroy:function(t){this.destroy=e,this.fire("destroy"),this.set=e,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:g,fire:m,on:b,set:function(e){this._set(t({},e)),this.root._lock||_(this.root)},_recompute:e,_set:function(e){var n=this._state,s={},r=!1;for(var i in e=t(this._staged,e),this._staged={},e)this._differs(e[i],n[i])&&(s[i]=r=!0);r&&(this._state=t(t({},n),e),this._recompute(s,this._state),this._bind&&this._bind(s,this._state),this._fragment&&(this.fire("state",{changed:s,current:this._state,previous:n}),this._fragment.p(s,this._state),this.fire("update",{changed:s,current:this._state,previous:n})))},_stage:function(e){t(this._staged,e)},_mount:function(e,t){this._fragment[this._fragment.i?"i":"m"](e,t||null)},_differs:h};const x={};function C(e="core"){"chart"===e?window.__dw&&window.__dw.vis&&window.__dw.vis.meta&&(x[e]=window.__dw.vis.meta.locale||{}):x[e]="core"===e?dw.backend.__messages.core:Object.assign({},dw.backend.__messages.core,dw.backend.__messages[e])}function T(e,t="core"){if(e=e.trim(),x[t]||C(t),!x[t][e])return"MISSING:"+e;var n=x[t][e];return"string"==typeof n&&arguments.length>2&&(n=n.replace(/\$(\d)/g,(e,t)=>(t=2+Number(t),void 0===arguments[t]?e:arguments[t]))),n}var k={exports:{}};
/*!
	 * JavaScript Cookie v2.2.1
	 * https://github.com/js-cookie/js-cookie
	 *
	 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
	 * Released under the MIT license
	 */!function(e,t){var n;n=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var s in n)t[s]=n[s]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(s){function r(){}function i(t,n,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},r.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var o=JSON.stringify(n);/^[\{\[]/.test(o)&&(n=o)}catch(e){}n=s.write?s.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in i)i[c]&&(a+="; "+c,!0!==i[c]&&(a+="="+i[c].split(";")[0]));return document.cookie=t+"="+n+a}}function o(e,n){if("undefined"!=typeof document){for(var r={},i=document.cookie?document.cookie.split("; "):[],o=0;o<i.length;o++){var a=i[o].split("="),c=a.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var d=t(a[0]);if(c=(s.read||s)(c,d)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(r[d]=c,e===d)break}catch(e){}}return e?r[e]:r}}return r.set=i,r.get=function(e){return o(e,!1)},r.getJSON=function(e){return o(e,!0)},r.remove=function(t,n){i(t,"",e(n,{expires:-1}))},r.defaults={},r.withConverter=n,r}((function(){}))},e.exports=n()}(k);var N=k.exports;const E=new Set(["get","head","options","trace"]);function A(e,t={}){if(!t.fetch)try{t.fetch=window.fetch}catch(e){throw new Error("Neither options.fetch nor window.fetch is defined.")}if(!t.baseUrl)try{t.baseUrl=window.dw.backend.__api_domain.startsWith("http")?window.dw.backend.__api_domain:"//"+window.dw.backend.__api_domain}catch(e){throw new Error("Neither options.baseUrl nor window.dw is defined.")}const{payload:n,baseUrl:s,fetch:r,raw:i,...o}={payload:null,raw:!1,method:"GET",mode:"cors",credentials:"include",...t,headers:{"Content-Type":"application/json",...t.headers}},a=`${s.replace(/\/$/,"")}/${e.replace(/^\//,"")}`;let c;if(n&&(o.body=JSON.stringify(n)),o.headers["Content-Type"].startsWith("multipart/")&&delete o.headers["Content-Type"],o.disableCSFR||E.has(o.method.toLowerCase()))c=r(a,o);else{const e=N.get("crumb");e?(o.headers["X-CSRF-Token"]=e,c=r(a,o)):c=A("/v3/me",{fetch:r,baseUrl:s}).then(()=>{const e=N.get("crumb");e&&(o.headers["X-CSRF-Token"]=e)}).catch(()=>{}).then(()=>r(a,o))}return c.then(e=>{if(i)return e;if(!e.ok)throw new H(e);if(204===e.status||!e.headers.get("content-type"))return e;const t=e.headers.get("content-type").split(";")[0];return"application/json"===t?e.json():"image/png"===t||"application/pdf"===t?e.blob():e.text()})}A.get=S("GET"),A.patch=S("PATCH"),A.put=S("PUT");const L=A.post=S("POST");function S(e){return(t,n)=>{if(n&&n.method)throw new Error(`Setting option.method is not allowed in httpReq.${e.toLowerCase()}()`);return A(t,{...n,method:e})}}A.head=S("HEAD"),A.delete=S("DELETE");class H extends Error{constructor(e){super(),this.name="HttpReqError",this.status=e.status,this.statusText=e.statusText,this.message=`[${e.status}] ${e.statusText}`,this.response=e}}function U(e,t){var i,a,c,d=e._slotted.labelExtra;return{c(){i=o("label"),a=o("noscript"),i.className="control-label svelte-150khnx"},m(e,r){s(e,i,r),n(i,a),a.insertAdjacentHTML("beforebegin",t.label),d&&(n(i,c||(c=document.createComment(""))),n(i,d))},p(e,t){e.label&&(!function(e){for(;e.previousSibling;)e.parentNode.removeChild(e.previousSibling)}(a),a.insertAdjacentHTML("beforebegin",t.label))},d(e){e&&r(i),d&&function(e,t){for(;e.nextSibling;)t.appendChild(e.nextSibling)}(c,d)}}}function j(e,t){var n;return{c(){(n=o("div")).className="help success svelte-150khnx"},m(e,r){s(e,n,r),n.innerHTML=t.success},p(e,t){e.success&&(n.innerHTML=t.success)},d(e){e&&r(n)}}}function I(e,t){var n;return{c(){(n=o("div")).className="help error svelte-150khnx"},m(e,r){s(e,n,r),n.innerHTML=t.error},p(e,t){e.error&&(n.innerHTML=t.error)},d(e){e&&r(n)}}}function M(e,t){var n;return{c(){(n=o("div")).className="help svelte-150khnx"},m(e,r){s(e,n,r),n.innerHTML=t.help},p(e,t){e.help&&(n.innerHTML=t.help)},d(e){e&&r(n)}}}function $(e){var i,c,d,p,h,f,m,_,g,b,w,y,x,C;v(this,e),this._state=t({label:"",help:"",compact:!1,class:"",error:!1,success:!1,width:"auto",uid:""},e.data),this._intro=!0,this._slotted=e.slots||{},this._fragment=(i=this,c=this._state,b=i._slotted.default,w=c.label&&U(i,c),y=c.success&&j(0,c),x=c.error&&I(0,c),C=!c.success&&!c.error&&c.help&&M(0,c),{c(){d=o("div"),w&&w.c(),p=a("\n    "),h=o("div"),f=a("\n    "),y&&y.c(),m=a(" "),x&&x.c(),_=a(" "),C&&C.c(),h.className="form-controls svelte-150khnx",d.className=g="form-block "+c.class+" svelte-150khnx",l(d,"width",c.width),d.dataset.uid=c.uid,u(d,"compact",c.compact),u(d,"success",c.success),u(d,"error",c.error)},m(e,t){s(e,d,t),w&&w.m(d,null),n(d,p),n(d,h),b&&n(h,b),n(d,f),y&&y.m(d,null),n(d,m),x&&x.m(d,null),n(d,_),C&&C.m(d,null)},p(e,t){t.label?w?w.p(e,t):((w=U(i,t)).c(),w.m(d,p)):w&&(w.d(1),w=null),t.success?y?y.p(e,t):((y=j(0,t)).c(),y.m(d,m)):y&&(y.d(1),y=null),t.error?x?x.p(e,t):((x=I(0,t)).c(),x.m(d,_)):x&&(x.d(1),x=null),t.success||t.error||!t.help?C&&(C.d(1),C=null):C?C.p(e,t):((C=M(0,t)).c(),C.m(d,null)),e.class&&g!==(g="form-block "+t.class+" svelte-150khnx")&&(d.className=g),e.width&&l(d,"width",t.width),e.uid&&(d.dataset.uid=t.uid),(e.class||e.compact)&&u(d,"compact",t.compact),(e.class||e.success)&&u(d,"success",t.success),(e.class||e.error)&&u(d,"error",t.error)},d(e){e&&r(d),w&&w.d(),b&&function(e,t){for(;e.firstChild;)t.appendChild(e.firstChild)}(h,b),y&&y.d(),x&&x.d(),C&&C.d()}}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor))}t($.prototype,y);var R={async createAccount(e){var t,n,s,r;this.set({signedUp:!0}),t="Chart Editor",n="send-embed-code",window._paq&&window._paq.push(["trackEvent",t,n,s,r]);try{await L("/v3/auth/signup",{payload:{email:e,invitation:!0,chartId:this.store.get().id}}),window.location.reload()}catch(e){if("HttpReqError"===e.name){const t=await e.response.json();this.set({error:t.message||e})}else this.set({error:"Unknown error: "+e})}}};function P(t,n){var i,c,d,l=T("publish / guest / h1"),u=T("publish / guest / p");return{c(){i=o("h2"),c=a("\n\n            "),d=o("p")},m(e,t){s(e,i,t),i.innerHTML=l,s(e,c,t),s(e,d,t),d.innerHTML=u},p:e,d(e){e&&(r(i),r(c),r(d))}}}function B(e,t){var n,a;return{c(){n=o("noscript"),a=o("noscript")},m(e,r){s(e,n,r),n.insertAdjacentHTML("afterend",t.guestAboveInvite),s(e,a,r)},p(e,t){e.guestAboveInvite&&(i(n,a),n.insertAdjacentHTML("afterend",t.guestAboveInvite))},d(e){e&&(i(n,a),r(n),r(a))}}}function D(e,t){var i,c;return{c(){i=o("div"),c=a(t.error),i.className="mt-2 alert alert-warning"},m(e,t){s(e,i,t),n(i,c)},p(e,t){e.error&&function(e,t){e.data=""+t}(c,t.error)},d(e){e&&r(i)}}}function O(e){v(this,e),this._state=t({error:"",email:"",guestAboveInvite:"",guestBelowInvite:"",signedUp:!1},e.data),this._intro=!0,this._fragment=function(e,t){var u,p,h,f,m,_,g,v,b,w,y,x,C,k,N,E,A,L,S,H,U,j,I=!1,M=T("publish / guest / cta"),R=T("publish / guest / back");function O(e){return e.guestAboveInvite?B:P}var F=O(t),q=F(e,t);function J(){I=!0,e.set({email:_.value}),I=!1}function G(n){e.createAccount(t.email)}var W={label:T("publish / guest / e-mail"),help:T("publish / guest / example-email")},X=new $({root:e.root,store:e.store,slots:{default:document.createDocumentFragment()},data:W}),Z=t.error&&D(e,t);return{c(){var e,n,s;u=o("div"),p=o("div"),h=o("div"),q.c(),f=a("\n\n        "),m=o("div"),_=o("input"),g=a("\n\n                "),v=o("button"),b=o("i"),y=a("\n                      "),x=o("noscript"),X._fragment.c(),C=a("\n\n        "),k=o("noscript"),N=o("noscript"),E=a("\n\n        "),A=o("div"),L=o("button"),S=o("i"),H=a("   "),U=o("noscript"),j=a("\n\n            "),Z&&Z.c(),l(h,"margin-bottom","20px"),c(_,"input",J),e=_,n="type",null==(s="email")?e.removeAttribute(n):e.setAttribute(n,s),_.className="input-xlarge",b.className=w="fa "+(t.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"),c(v,"click",G),v.className="btn btn-save btn-primary",l(v,"white-space","nowrap"),l(v,"margin-left","10px"),l(m,"display","flex"),S.className="fa fa-chevron-left",L.className="btn btn-save btn-default btn-back",l(A,"margin-top","30px"),p.className="span5",u.className="row publish-signup"},m(e,r){s(e,u,r),n(u,p),n(p,h),q.m(h,null),n(p,f),n(X._slotted.default,m),n(m,_),_.value=t.email,n(m,g),n(m,v),n(v,b),n(v,y),n(v,x),x.insertAdjacentHTML("afterend",M),X._mount(p,null),n(p,C),n(p,k),k.insertAdjacentHTML("afterend",t.guestBelowInvite),n(p,N),n(p,E),n(p,A),n(A,L),n(L,S),n(L,H),n(L,U),U.insertAdjacentHTML("afterend",R),n(A,j),Z&&Z.m(A,null)},p(n,s){F===(F=O(t=s))&&q?q.p(n,t):(q.d(1),(q=F(e,t)).c(),q.m(h,null)),!I&&n.email&&(_.value=t.email),n.signedUp&&w!==(w="fa "+(t.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"))&&(b.className=w),n.guestBelowInvite&&(i(k,N),k.insertAdjacentHTML("afterend",t.guestBelowInvite)),t.error?Z?Z.p(n,t):((Z=D(e,t)).c(),Z.m(A,null)):Z&&(Z.d(1),Z=null)},d(e){e&&r(u),q.d(),d(_,"input",J),d(v,"click",G),X.destroy(),Z&&Z.d()}}}(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),_(this))}function F(e,n){this._handlers={},this._dependents=[],this._computed=p(),this._sortedComputedProperties=[],this._state=t({},e),this._differs=n&&n.immutable?f:h}t(O.prototype,y),t(O.prototype,R),t(F.prototype,{_add(e,t){this._dependents.push({component:e,props:t})},_init(e){const t={};for(let n=0;n<e.length;n+=1){const s=e[n];t["$"+s]=this._state[s]}return t},_remove(e){let t=this._dependents.length;for(;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_set(e,n){const s=this._state;this._state=t(t({},s),e);for(let e=0;e<this._sortedComputedProperties.length;e+=1)this._sortedComputedProperties[e].update(this._state,n);this.fire("state",{changed:n,previous:s,current:this._state}),this._dependents.filter(e=>{const t={};let s=!1;for(let r=0;r<e.props.length;r+=1){const i=e.props[r];i in n&&(t["$"+i]=this._state[i],s=!0)}if(s)return e.component._stage(t),!0}).forEach(e=>{e.component.set({})}),this.fire("update",{changed:n,previous:s,current:this._state})},_sortComputedProperties(){const e=this._computed,t=this._sortedComputedProperties=[],n=p();let s;function r(i){const o=e[i];o&&(o.deps.forEach(e=>{if(e===s)throw new Error(`Cyclical dependency detected between ${e} <-> ${i}`);r(e)}),n[i]||(n[i]=!0,t.push(o)))}for(const e in this._computed)r(s=e)},compute(e,n,s){let r;const i={deps:n,update:(t,i,o)=>{const a=n.map(e=>(e in i&&(o=!0),t[e]));if(o){const n=s.apply(null,a);this._differs(n,r)&&(r=n,i[e]=!0,t[e]=r)}}};this._computed[e]=i,this._sortComputedProperties();const o=t({},this._state),a={};i.update(o,a,!0),this._set(o,a)},fire:m,get:g,on:b,set(e){const t=this._state,n=this._changed={};let s=!1;for(const r in e){if(this._computed[r])throw new Error(`'${r}' is a read-only computed property`);this._differs(e[r],t[r])&&(n[r]=s=!0)}s&&this._set(e,n)}});return{App:O,store:new F({})}}));
//# sourceMappingURL=guest.js.map
